--- spal60sr\src\TSSGCtrl\SSFloatCalc.original.cpp	Sun Apr  6 21:44:14 2003
+++ spal60sr\src\TSSGCtrl\SSFloatCalc.cpp	Sun Apr  6 21:44:14 2003
@@ -1,6 +1,14 @@
 #include "SSFloatCalc.h"
 #include "BitOperation.h"
 
+#define FORCE_FUNNEL    1
+#define MIN_MAX_SUPPORT 1
+
+#if MIN_MAX_SUPPORT
+#include <float.h>
+#include "intrinsic.h"
+#endif
+
 //---------------------------------------------------------------------
 //「初期設定関数」
 //
@@ -29,6 +37,19 @@
 	else			size=8;
  }
 
+#if MIN_MAX_SUPPORT
+ if (tmpV[1].length() == 3)
+	if (*(LPDWORD)tmpV[1].begin() == BSWAP32('min\0'))
+		min = size == 8 ? -DBL_MAX : -FLT_MAX + 3.7778931862957161709568e+22;
+	else if (*(LPDWORD)tmpV[1].begin() == BSWAP32('max\0'))
+		min = size == 8 ? DBL_MAX : FLT_MAX - 3.7778931862957161709568e+22;
+ if (tmpV[2].length() == 3)
+	if (*(LPDWORD)tmpV[2].begin() == BSWAP32('min\0'))
+		max = size == 8 ? -DBL_MAX : -FLT_MAX + 3.7778931862957161709568e+22;
+	else if (*(LPDWORD)tmpV[2].begin() == BSWAP32('max\0'))
+		max = size == 8 ? DBL_MAX : FLT_MAX - 3.7778931862957161709568e+22;
+#endif
+
  isBigEndian = (tmpV[4]=="big_e");
 
 
@@ -57,14 +78,25 @@
  Setting(SSGC);
 
  TSmartHandle SHandle;
+#if !LOCAL_MEMORY_SUPPORT
  if(( SHandle=SSGC.Open(this, PROCESS_VM_READ) )==NULL)
+#else
+ if ((SHandle = SSGC.Open(this, PROCESS_VM_READ, addressStr.c_str())) == NULL)
+#endif
 	return ssgCtrl::reOPEN_ERROR;	//プロセスのオープンエラー
 
+#if !SUBJECT_STATUS
  if(!SSGC.IsEnabled(this)) return ssgCtrl::reNOT_ENABLED;	//有効条件が偽
+#else
+ if(!SSGC.IsEnabled(this, TRUE)) return ssgCtrl::reNOT_ENABLED;	//有効条件が偽
+#endif
 
 
  //属性を適用
  unsigned long Address = SSGC.GetAddress(this, addressStr);
+#if SUBJECT_STATUS
+ address = (const BYTE *)Address;
+#endif
 
  double Num = 0;  //初期化
 
@@ -101,7 +133,11 @@
  Setting(SSGC);
 
  TSmartHandle SHandle;
+#if !LOCAL_MEMORY_SUPPORT
  if(( SHandle=SSGC.Open(this, PROCESS_VM_READ|PROCESS_VM_WRITE|PROCESS_VM_OPERATION) )==NULL)
+#else
+ if ((SHandle = SSGC.Open(this, PROCESS_VM_READ | PROCESS_VM_WRITE | PROCESS_VM_OPERATION, addressStr.c_str())) == NULL)
+#endif
 	return ssgCtrl::reOPEN_ERROR;	//プロセスのオープンエラー
 
  if(!SSGC.IsEnabled(this)) return ssgCtrl::reNOT_ENABLED;	//有効条件が偽
@@ -109,6 +145,9 @@
 
  //属性を適用
  unsigned long Address = SSGC.GetAddress(this, addressStr);
+#if SUBJECT_STATUS
+ address = (const BYTE *)Address;
+#endif
 
  double Num = ((TSSArgDouble*)Arg)->GetValue();
  Num = SSGC.CheckIO_FEPDouble(this, Num, ssgCtrl::ftTO_OUTPUT);
@@ -130,6 +169,9 @@
 	}
  }
 
+#if FORCE_FUNNEL
+ SSGC.CheckFunnel(this, 0);
+#endif
  return ssgCtrl::reNO_ERROR;
 }
 //---------------------------------------------------------------------
